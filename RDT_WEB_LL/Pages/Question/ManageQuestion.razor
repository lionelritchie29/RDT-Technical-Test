@page "/manage/questions"

@using RDT_WEB_LL.Models
@using RDT_WEB_LL.Services
@using RDT_WEB_LL.Components

@inject IQuestionServices questionService

@attribute [Authorize(Roles = "Admin")]

<div class="d-flex">
    <h3>Manage Questions</h3>
    <div class="ml-3">
        <NavLink class="btn btn-primary" href="manage/questions/add" Match="NavLinkMatch.All">
            Add new question
        </NavLink>
    </div>
</div>

@if (questions is null)
{
    <p>Loading data...</p>
}
else
{
    <div class="d-flex">
        <div class="w-75">
            <div class="row mt-3">
                @foreach (var q in questions)
                {
                    <div class="col-4 mb-4">
                        <QuestionCard question=@q>
                            <QuestionCardManageContent question="@q" OnShowDetail="OnShowQuestionDetail"></QuestionCardManageContent>
                        </QuestionCard>
                    </div>
                }
            </div>
        </div>
        <div class="w-25 ml-3 pl-3 border-left border-secondary">
            <div class="mt-3">
                <DetailQuestionCard question=@selectedQuestion OnDeleteCallback=@fetchQuestions></DetailQuestionCard>
            </div>
        </div>
    </div>
}


@code {
    List<Question> questions;

    Question selectedQuestion = null;

    protected override void OnInitialized()
    {
        fetchQuestions();
    }

    protected void OnShowQuestionDetail(int id)
    {
        selectedQuestion = questions.Find(q => q.Id == id);
    }

    private void fetchQuestions()
    {
        questions = questionService.GetAll();
    }
}
